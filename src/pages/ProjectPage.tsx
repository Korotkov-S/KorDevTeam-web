import React, { useEffect } from "react";
import { useParams, useNavigate } from "react-router-dom";
import ReactMarkdown from "react-markdown";
import { Card, CardContent } from "../components/ui/card";
import { Badge } from "../components/ui/badge";
import { Button } from "../components/ui/button";
import { ImageWithFallback } from "../components/figma/ImageWithFallback";
import { ArrowLeft, ExternalLink, Github } from "lucide-react";

// Расширенные данные проектов
const projects = [
  {
    id: "Mediа & Entertainment",
    title: "Мобильное приложение для бизнес-клуба Noodome",
    description:
      "Цифровой ключ участника: бронирование переговорок, оплата ресторана, события, нетворкинг, личный кабинен.",
    fullDescription: `## Основные разделы и функции приложения

### 1. Личный кабинет и членство

**Статус членства:** Информация о типе членства, сроке его действия и списке доступных опций.

**История посещений и активностей:** Просмотр ваших прошлых бронирований, посещенных мероприятий и транзакций.

### 2. Бронирование переговорных комнат

#### Бронирование переговорных комнат:
- Просмотр расписания доступности комнат
- Выбор даты, времени и продолжительности брони
- Мгновенное подтверждение брони
- Управление своими бронированиями (отмена, перенос)

#### Оплата счета вресторане:
- Возможность оплатить счет в ресторане через мобильное приложение

### 3. События и мероприятия (Центр социальной жизни клуба)

**Афиша событий:** Полное расписание всех предстоящих мероприятий клуба — мастер-классы, воркшопы, встречи с экспертами, нетворкинги.

**Регистрация на события:** Запись на интересующие мероприятия прямо из приложения.

**Функция "Я пойду"** для планирования своего графика.

**Уведомления:** Push-уведомления о новых событиях, напоминания о начале зарегистрированного мероприятия, изменениях в программе.

**Архив событий:** Возможность посмотреть материалы или фото с прошедших мероприятий.

### 4. Нетворкинг и сообщество

**Профили участников** (с ограниченным доступом): возможность просматривать профили других участников клуба

**Указание сферы деятельности, компании и интересов** для удобного нетворкинга.

**Список гостей мероприятия:** Просмотр, кто еще идет на событие, чтобы заранее планировать знакомства.

**Безопасный чат:** Возможность обмениваться сообщениями с другими членами клуба или администрацией через защищенный канал внутри приложения.

### 5. Ресторан и сервисы

**Цифровое меню:** Просмотр меню ресторана Noodome с актуальными позициями и ценами.

**Депозитная система и безналичные расчеты:** Привязка банковской карты для удобной оплаты счетов в ресторане и других услуг внутри клуба без использования наличных.

### 6. Уведомления и обратная связь

**Персонализированные уведомления:** Информация о специальных предложениях, изменениях в работе клуба, персональных приглашениях.`,
    image: "/projects/noodome.png",
    technologies: ["React Native", "Node.js", "PostgreSQL"],
    features: [
      "Регистрация на мероприятия клуба",
      "Броинрование переговорных комнат",
      "Оплата ресторана через приложение",
      "Чат с другими участниками клуба",
      "Бонусы и предложения партнеров клуба",
    ],
    demoUrl: "#",
    githubUrl: "#",
  },
  {
    id: "web-site",
    title: "Сайт строительной компании Альянс-Строй-Гарант",
    description:
      "Сайт для ООО «АльянсСтройГарант» — это корпоративный веб-ресурс, предназначенный для презентации услуг компании в сфере строительства и ремонта. Сайт разработан с использованием современных технологий (React.js, Laravel, MySQL) и адаптирован для всех устройств. Его основная цель — привлечение клиентов через удобный интерфейс, интерактивные элементы и функционал для обработки заявок.",
    fullDescription: `## Сайт строительной компании Альянс-Строй-Гарант

Корпоративный веб-ресурс для презентации услуг компании в сфере строительства и ремонта, разработанный с использованием современных технологий и адаптированный для всех устройств.

### Адаптивный и отзывчивый дизайн

- **Поддержка разрешений:** 1440px, 1024px, 768px, 320px
- **Кроссбраузерная совместимость:** Chrome, Firefox, Safari, Яндекс.Браузер

### Интерактивные элементы

- **Модальные окна** для обратной связи и калькулятора стоимости ремонта
- **Формы с валидацией** данных (имя, телефон, email)
- **Горизонтальный скролл** для карточек услуг и портфолио

### Калькулятор стоимости ремонта

- **Пошаговый расчет** стоимости на основе параметров: количество комнат, площадь, дизайн, тип недвижимости
- **Интеграция с формой** обратной связи

### Основные секции сайта

#### Услуги
Карточки с фильтрацией по категориям (коммерция, квартиры, доп. услуги)

#### Портфолио
Галерея выполненных проектов с модальными окнами для детального просмотра

#### Этапы работ
Таймлайн с инфографикой

#### Отзывы
Интерактивные карточки с модальными окнами

#### О компании
Юридическая информация, реестры, данные о руководстве

#### Контакты
Карта, реквизиты, форма обратной связи

### Интеграции и уведомления

- **Отправка данных форм** в Telegram-канал заказчика
- **Генерация PDF** с реквизитами компании

### Технические требования

- **Соответствие 152-ФЗ** (обработка персональных данных)
- **Ежедневное резервное копирование**

### SEO и доступность

- **Оптимизация мета-тегов**, заголовков, ALT-текстов
- **Чистая семантическая верстка**
- **Поддержка Яндекс.Метрики** и Вебвизора

### Дополнительные страницы

- **Страница «О компании»** с юридическими данными
- **Страница «Контакты»** с картой и реквизитами
- **Кастомная 404 страница** с переходом на главную`,
    image: "/projects/asg.png",
    technologies: ["React.js", "Laravel", "MySQL"],
    features: [
      "Адаптивный дизайн для всех устройств",
      "Калькулятор стоимости ремонта",
      "Интерактивные модальные окна",
      "Интеграция с Telegram для уведомлений",
      "SEO оптимизация",
      "Формы обратной связи с валидацией",
    ],
    demoUrl: "#",
    githubUrl: "#",
  },
  {
    id: "web-service",
    title: "SimsDynastyTree",
    description:
      "Инструмент фанатов для создания и ведения детальных генеалогических древ Sims.",
    fullDescription: `## Sims Dynasty Tree

Специализированный онлайн-сервис, созданный фанатами The Sims, который превращает стандартную внутриигровую систему родства в мощный инструмент для глубокого сторителлинга и сохранения памяти о вашей уникальной династии.

### Расширенное создание и кастомизация древа

- **Глубокие анкеты персонажей:** Возможность добавления не только имени и фото, но и дат рождения, черт характера, карьеры, образования, жизненных целей, места жительства и произвольных заметок
- **Полная визуальная кастомизация:** Смена цветовой схемы, фона древа и стилей аватаров (включая премиум-варианты)
- **Неограниченный масштаб:** Создавайте любое количество древ и добавляйте неограниченное количество поколений

### Углубленный сторителлинг и организация

- **Детальные биографии:** Напишите уникальную историю жизни для каждого сима, отмечая ключевые события и особенности
- **Медиа-альбомы:** Прикрепляйте несколько фотографий ко всему древу, поколению или отдельному персонажу, чтобы запечатлеть их жизнь на разных возрастных стадиях
- **Связывание древ:** Для премиум-пользователей — функция объединения разных династий, позволяющая создавать сложные разветвленные вселенные

### Социальные и публичные функции

- **Публичные и приватные древа:** Поделитесь своим творением с сообществом или сохраните его в приватном доступе
- **Публичные ссылки:** У публичных древ есть понятные ссылки с названием династии и именем автора для удобного просмотра

### Постоянное развитие и поддержка

- **Регулярные обновления:** Команда оперативно добавляет контент из новых игровых дополнений (карьеры, черты, цели и т.д.)
- **Активная техническая поддержка:** Система уведомлений о новостях и обновлениях, а также постоянная работа над стабильностью и удобством интерфейса

### Гибкая модель доступа

- **Бесплатный базовый функционал:** Доступно создание древ, заполнение базовой информации и использование основных возможностей
- **Премиум-подписка:** Открывает расширенные функции: премиум-аватары, связывание древ между собой и другие эксклюзивные возможности

### Заключение

Sims Dynasty Tree — это проект, созданный симмерами для симмеров. Он решает ключевую проблему игроков в "поколения" — необходимость сохранять и структурировать сложные семейные истории, выходя далеко за рамки ограниченного внутриигрового функционала.`,
    image: "/projects/sims.png",
    technologies: ["Next.js", "Node.js", "PostgreSQL"],
    features: [
      "Создание генеалогических древ",
      "Детальные анкеты персонажей",
      "Медиа-альбомы и биографии",
      "Публичные и приватные древа",
      "Премиум-функции",
      "Социальные функции",
    ],
    demoUrl: "https://simsdynastytree.com/ru",
  },
  {
    id: "harmonize-me",
    title: "HarmonizeMe",
    description:
      "Harmonize Me — это образовательная онлайн-платформа, помогающая достичь гармонии с телом и питанием через психотерапевтический подход. Проект предлагает курсовые программы, сочетающие экспертные знания и игровые методики для формирования здоровых отношений с едой и собственным телом.",
    fullDescription: `# HarmonizeMe

**Образовательная онлайн-платформа для достижения гармонии с телом и питанием через психотерапевтический подход.**

## Ключевые функции проекта

### 1. Многоуровневая система курсов

- **Платформенные курсы** по фиксированной цене:
  - "Питайся с удовольствием"
  - "Смотрю с любовью" 
  - "Моё любимое тело"
- **Конструктор курсов** с возможностью выбора тематических видео (49 вариантов)
- **Бесплатный вводный курс** для знакомства с методикой

### 2. Персонализированное обучение

- **Личный кабинет** с отслеживанием прогресса
- **Система бонусов** за прохождение уроков и активность
- **ИИ-помощник** для оперативной поддержки студентов

### 3. Интегрированная система мотивации

- **Накопительные бонусы** за учебную активность
- **Внутренний магазин (HarmoMarket)** для обмена бонусов на премиум-контент
- **Механизм рекомендаций** через социальные сети

### 4. Технологическая инфраструктура

- **Адаптивный интерфейс** для всех устройств
- **Многоязычная поддержка** (RU/EN)
- **Безопасная система** регистрации и платежей
- **Чат-бот** для оперативной помощи

### 5. Дополнительные сервисы

- **База знаний** с полезными материалами
- **Терапевтические группы** в Telegram
- **Возможность онлайн-записи** на программы

### 6. Продуманная бизнес-модель

- **Гибкая система оплаты** (разовые платежи и бонусная программа)
- **Встроенные механизмы** удержания аудитории
- **Инструменты для viral-маркетинга**

---

**Платформа создает комплексную экосистему для работы с пищевым поведением и самовосприятием, сочетая образовательные методики с элементами геймификации и психологической поддержки.**

`,
    image: "/projects/harmonizeMe.png",
    technologies: ["Next.js", "Adonis.js", "PostgreSQL"],
    features: [
      "Многоуровневая система курсов",
      "Персонализированное обучение",
      "ИИ-помощник для поддержки",
      "Система бонусов и мотивации",
      "Внутренний магазин HarmoMarket",
      "Терапевтические группы в Telegram",
    ],
    demoUrl: "https://iharmo.com/ru",
  },
];

export function ProjectPage() {
  const { projectId } = useParams<{ projectId: string }>();
  const navigate = useNavigate();

  const project = projects.find((p) => p.id === projectId);

  const navigateGoBack = () => {
    if (window.history.state?.idx > 0) {
      navigate(-1);
    } else {
      navigateGoBack();
    }
  };

  // Автоматический скролл наверх при загрузке страницы
  useEffect(() => {
    window.scrollTo({
      top: 0,
      left: 0,
      behavior: "smooth",
    });
  }, [projectId]);

  if (!project) {
    return (
      <div className="min-h-screen pt-20 flex items-center justify-center">
        <div className="text-center">
          <h1 className="text-2xl font-bold mb-4">Проект не найден</h1>
          <Button onClick={() => navigateGoBack()}>
            <ArrowLeft className="w-4 h-4 mr-2" />
            Вернуться на главную
          </Button>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen pt-20">
      <div className="container mx-auto px-4 py-8">
        {/* Back Button */}
        <div className="mb-8">
          <Button variant="ghost" onClick={navigateGoBack} className="gap-2">
            <ArrowLeft className="w-4 h-4" />
            Назад к главной
          </Button>
        </div>

        <article className="max-w-4xl mx-auto">
          {/* Project Header */}
          <header className="mb-12 pb-8 border-b border-border">
            <h1 className="text-4xl md:text-5xl mb-6">{project.title}</h1>
            <p className="text-muted-foreground text-lg leading-relaxed mb-6">
              {project.description}
            </p>
          </header>
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
            {/* Изображение */}
            <div className="space-y-4">
              <div className="aspect-video rounded-lg overflow-hidden">
                <ImageWithFallback
                  src={project.image}
                  alt={project.title}
                  className="w-full h-full object-cover"
                />
              </div>

              {/* Кнопки действий */}
              <div className="flex gap-4">
                <Button asChild className="flex-1">
                  <a
                    href={project.demoUrl}
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    <ExternalLink className="w-4 h-4 mr-2" />
                    Демо
                  </a>
                </Button>
                <Button variant="outline" asChild className="flex-1">
                  <a
                    href={project.githubUrl}
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    <Github className="w-4 h-4 mr-2" />
                    GitHub
                  </a>
                </Button>
              </div>
            </div>

            {/* Описание */}
            <div className="space-y-6">
              <Card>
                <CardContent className="p-6">
                  <h2 className="text-xl font-semibold mb-4">
                    Описание проекта
                  </h2>
                  <div className="prose prose-invert prose-lg max-w-none">
                    <ReactMarkdown
                      components={{
                        h1: ({ node, ...props }) => (
                          <h1
                            className="text-3xl mb-6 mt-8 text-foreground"
                            {...props}
                          />
                        ),
                        h2: ({ node, ...props }) => (
                          <h2
                            className="text-2xl mt-8 mb-4 text-foreground"
                            {...props}
                          />
                        ),
                        h3: ({ node, ...props }) => (
                          <h3
                            className="text-xl mt-6 mb-3 text-foreground"
                            {...props}
                          />
                        ),
                        h4: ({ node, ...props }) => (
                          <h4
                            className="text-lg mt-4 mb-2 text-foreground"
                            {...props}
                          />
                        ),
                        p: ({ node, ...props }) => (
                          <p
                            className="text-muted-foreground mb-4 leading-relaxed"
                            {...props}
                          />
                        ),
                        strong: ({ node, ...props }) => (
                          <strong
                            className="text-foreground font-semibold"
                            {...props}
                          />
                        ),
                        ul: ({ node, ...props }) => (
                          <ul
                            className="list-disc list-inside text-muted-foreground mb-4 space-y-2 ml-4"
                            {...props}
                          />
                        ),
                        li: ({ node, ...props }) => (
                          <li className="text-muted-foreground" {...props} />
                        ),
                      }}
                    >
                      {project.fullDescription}
                    </ReactMarkdown>
                  </div>
                </CardContent>
              </Card>

              {/* Технологии */}
              <Card>
                <CardContent className="p-6">
                  <h3 className="text-lg font-semibold mb-4">
                    Использованные технологии
                  </h3>
                  <div className="flex flex-wrap gap-2">
                    {project.technologies.map((tech, index) => (
                      <Badge
                        key={index}
                        variant="outline"
                        className="border-primary/30 text-primary"
                      >
                        {tech}
                      </Badge>
                    ))}
                  </div>
                </CardContent>
              </Card>

              {/* Функциональность */}
              <Card>
                <CardContent className="p-6">
                  <h3 className="text-lg font-semibold mb-4">
                    Основные функции
                  </h3>
                  <ul className="space-y-2">
                    {project.features.map((feature, index) => (
                      <li key={index} className="flex items-start">
                        <span className="w-2 h-2 bg-primary rounded-full mt-2 mr-3 flex-shrink-0"></span>
                        <span className="text-muted-foreground">{feature}</span>
                      </li>
                    ))}
                  </ul>
                </CardContent>
              </Card>
            </div>
          </div>

          {/* Back to Projects Button */}
          <div className="mt-12 pt-8 border-t border-border">
            <Button onClick={navigateGoBack} className="gap-2">
              <ArrowLeft className="w-4 h-4" />
              Вернуться к проектам
            </Button>
          </div>
        </article>
      </div>
    </div>
  );
}
